

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>A Level-2 Sea Ice Drift (SID) algorithm for CIMR &#8212; CIMR L2 Sea Ice Drift ATBD v1</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=bd9e20870c6007c4c509" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles.css" />
    <link rel="stylesheet" type="text/css" href="_static/watermark.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509" />
  <script src="_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=bd9e20870c6007c4c509"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'CIMR_L2_Sea_Ice_Drift_algorithm';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="A Level-2 Sea Ice Drift (SID) algorithm for CIMR" href="CIMR_L2_Sea_Ice_Drift_performanceAssessment.html" />
    <link rel="prev" title="Algorithm Input and Output Data Definition (IODD)" href="algorithm_input_output_data_definition.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <header>
  
    <div class="bd-header navbar navbar-expand-lg bd-navbar">
    </div>
  
  </header>

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.jpg" class="logo__image only-light" alt="CIMR L2 Sea Ice Drift ATBD v1 - Home"/>
    <script>document.write(`<img src="_static/logo.jpg" class="logo__image only-dark" alt="CIMR L2 Sea Ice Drift ATBD v1 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    CIMR L2 Sea Ice Drift ATBD
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="abstract.html">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="applicable_ref_docs.html">Applicable and Reference Documents</a></li>
<li class="toctree-l1"><a class="reference internal" href="acronyms.html">Acronyms</a></li>
<li class="toctree-l1"><a class="reference internal" href="definitions.html">Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction_purpose_scope.html">Introduction, purpose and scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_justification_algorithm.html">Background and justification of selected algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="L2_product_definition.html">Level-2 product definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="baseline_algorithm_definition.html">Baseline Algorithm Definition</a></li>
<li class="toctree-l1"><a class="reference internal" href="algorithm_input_output_data_definition.html">Algorithm Input and Output Data Definition (IODD)</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">A Level-2 Sea Ice Drift (SID) algorithm for CIMR</a></li>


<li class="toctree-l1"><a class="reference internal" href="CIMR_L2_Sea_Ice_Drift_performanceAssessment.html">Prototype Performance Assessment (ATBD v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="roadmap_for_future_atbd_developments.html">Roadmap for future ATBD developments (ATBD v2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/CIMR-Algos/SeaIceDrift_ATBD" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/CIMR_L2_Sea_Ice_Drift_algorithm.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>A Level-2 Sea Ice Drift (SID) algorithm for CIMR</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">A Level-2 Sea Ice Drift (SID) algorithm for CIMR</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#settings">Settings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parametrize-the-run">Parametrize the run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-pre-processing-icemask-loading-the-files-laplacian-pre-processing">Step 1: Pre-processing (Icemask, loading the files, Laplacian pre-processing)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1a-creating-and-regridding-the-ice-mask">Step 1a: Creating and regridding the ice mask</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1b-loading-the-data">Step 1b: Loading the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1c-regridding-the-data">Step 1c: Regridding the data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1d-laplacian-pre-processing">Step 1d: Laplacian pre-processing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1e-writing-out-the-file">Step 1e: Writing out the file</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1f-temporary-creating-a-test-gridded-file-with-time-difference-24h-and-pixel-shifts-added-in-each-x-and-y">Step 1f (temporary): Creating a test gridded file with “time difference” 24h and pixel shifts added in each x and y</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-cross-correlation-algorithm">Step 2: Cross-correlation algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2a-run-the-cross-correlation-algorithm-to-find-the-ice-drift">Step 2a: Run the cross-correlation algorithm to find the ice drift</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2b-format-l2-file-and-write-to-disk">Step 2b: Format L2 file and write to disk</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2c-plotting">Step 2c: Plotting</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="a-level-2-sea-ice-drift-sid-algorithm-for-cimr">
<h1>A Level-2 Sea Ice Drift (SID) algorithm for CIMR<a class="headerlink" href="#a-level-2-sea-ice-drift-sid-algorithm-for-cimr" title="Permalink to this heading">#</a></h1>
<p>This notebook implements a prototype for a Level-2 SIED algorithm for the CIMR mission.</p>
<p>We refer to the corresponding <a class="reference external" href="https://cimr-algos.github.io/SeaIceDrift_ATBD/intro.html">ATBD</a> and especially the <a class="reference external" href="https://cimr-algos.github.io/SeaIceDrift_ATBD/baseline_algorithm_definition.html#baseline-algorithm-definition">Baseline Algorithm Definition</a>.</p>
<p>In particular, the figure below illustrates the overall concept of the processing:
<img src="https://cimr-algos.github.io/SeaIceDrift_ATBD/_images/CIMR_L2_Sea_Ice_Drift_Flow_Diagram.png" width="100%"/></p>
<section id="settings">
<h2>Settings<a class="headerlink" href="#settings" title="Permalink to this heading">#</a></h2>
<p>Imports and general settings</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> cython
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">get_ipython</span><span class="p">()</span><span class="o">.</span><span class="n">run_line_magic</span><span class="p">(</span><span class="s1">&#39;load_ext&#39;</span><span class="p">,</span> <span class="s1">&#39;cython&#39;</span><span class="p">)</span>

<span class="nn">File ~/.conda/envs/JB/lib/python3.11/site-packages/IPython/core/interactiveshell.py:2456,</span> in <span class="ni">InteractiveShell.run_line_magic</span><span class="nt">(self, magic_name, line, _stack_depth)</span>
<span class="g g-Whitespace">   </span><span class="mi">2454</span>     <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;local_ns&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_local_scope</span><span class="p">(</span><span class="n">stack_depth</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2455</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtin_trap</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2456</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2458</span> <span class="c1"># The code below prevents the output from being displayed</span>
<span class="g g-Whitespace">   </span><span class="mi">2459</span> <span class="c1"># when using magics with decorator @output_can_be_silenced</span>
<span class="g g-Whitespace">   </span><span class="mi">2460</span> <span class="c1"># when the last Python token in the expression is a &#39;;&#39;.</span>
<span class="g g-Whitespace">   </span><span class="mi">2461</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">magic</span><span class="o">.</span><span class="n">MAGIC_OUTPUT_CAN_BE_SILENCED</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>

<span class="nn">File ~/.conda/envs/JB/lib/python3.11/site-packages/IPython/core/magics/extension.py:33,</span> in <span class="ni">ExtensionMagics.load_ext</span><span class="nt">(self, module_str)</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">module_str</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span>     <span class="k">raise</span> <span class="n">UsageError</span><span class="p">(</span><span class="s1">&#39;Missing module name.&#39;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">33</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">extension_manager</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="n">module_str</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="s1">&#39;already loaded&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">36</span>     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The </span><span class="si">%s</span><span class="s2"> extension is already loaded. To reload it, use:&quot;</span> <span class="o">%</span> <span class="n">module_str</span><span class="p">)</span>

<span class="nn">File ~/.conda/envs/JB/lib/python3.11/site-packages/IPython/core/extensions.py:76,</span> in <span class="ni">ExtensionManager.load_extension</span><span class="nt">(self, module_str)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;Load an IPython extension by its module name.</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">71</span><span class="sd"> Returns the string &quot;already loaded&quot; if the extension is already loaded,</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span><span class="sd"> &quot;no load function&quot; if the module doesn&#39;t have a load_ipython_extension</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span><span class="sd"> function, or None if it succeeded.</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">76</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_extension</span><span class="p">(</span><span class="n">module_str</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span> <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>     <span class="k">if</span> <span class="n">module_str</span> <span class="ow">in</span> <span class="n">BUILTINS_EXTS</span><span class="p">:</span>

<span class="nn">File ~/.conda/envs/JB/lib/python3.11/site-packages/IPython/core/extensions.py:91,</span> in <span class="ni">ExtensionManager._load_extension</span><span class="nt">(self, module_str)</span>
<span class="g g-Whitespace">     </span><span class="mi">89</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">shell</span><span class="o">.</span><span class="n">builtin_trap</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">90</span>     <span class="k">if</span> <span class="n">module_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">91</span>         <span class="n">mod</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="n">module_str</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">92</span>     <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_str</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>     <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_load_ipython_extension</span><span class="p">(</span><span class="n">mod</span><span class="p">):</span>

<span class="nn">File ~/.conda/envs/JB/lib/python3.11/importlib/__init__.py:126,</span> in <span class="ni">import_module</span><span class="nt">(name, package)</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span>             <span class="k">break</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>         <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="ne">--&gt; </span><span class="mi">126</span> <span class="k">return</span> <span class="n">_bootstrap</span><span class="o">.</span><span class="n">_gcd_import</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">level</span><span class="p">:],</span> <span class="n">package</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>

<span class="nn">File &lt;frozen importlib._bootstrap&gt;:1204,</span> in <span class="ni">_gcd_import</span><span class="nt">(name, package, level)</span>

<span class="nn">File &lt;frozen importlib._bootstrap&gt;:1176,</span> in <span class="ni">_find_and_load</span><span class="nt">(name, import_)</span>

<span class="nn">File &lt;frozen importlib._bootstrap&gt;:1140,</span> in <span class="ni">_find_and_load_unlocked</span><span class="nt">(name, import_)</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;cython&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Paths</span>

<span class="c1"># Getting the path of the notebook (NOTE: not totally safe)</span>

<span class="c1"># The paths assume that there is an umbrella CIMR directory (of any name) containing SeaIceDrift_ATBD_v2/ ,</span>
<span class="c1"># the CIMR Tools/ directory, and a directory data/L1B/ containing the L1B data, and data/conc/ containing</span>
<span class="c1"># a concentration file</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">cpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;../..&#39;</span><span class="p">)</span>
<span class="n">algpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpath</span><span class="p">,</span> <span class="s1">&#39;SeaIceDrift_ATBD_v2/algorithm/src_sied&#39;</span><span class="p">)</span>
<span class="n">toolpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpath</span><span class="p">,</span> <span class="s1">&#39;Tools&#39;</span><span class="p">)</span>
<span class="n">l1bpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpath</span><span class="p">,</span> <span class="s1">&#39;data/L1B&#39;</span><span class="p">)</span>
<span class="n">griddeffile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpath</span><span class="p">,</span> <span class="s1">&#39;Overall_ATBD/etc/grids_py.def&#39;</span><span class="p">)</span>

<span class="c1"># Creating a directory structure for processing</span>
<span class="n">concpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpath</span><span class="p">,</span> <span class="s1">&#39;data/conc&#39;</span><span class="p">)</span>
<span class="n">icemaskpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpath</span><span class="p">,</span> <span class="s1">&#39;data/icemask&#39;</span><span class="p">)</span>
<span class="n">swathpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpath</span><span class="p">,</span> <span class="s1">&#39;data/swaths&#39;</span><span class="p">)</span>
<span class="n">procpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpath</span><span class="p">,</span> <span class="s1">&#39;data/processing&#39;</span><span class="p">)</span>
<span class="n">driftpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpath</span><span class="p">,</span> <span class="s1">&#39;data/icedrift&#39;</span><span class="p">)</span>
<span class="n">logpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpath</span><span class="p">,</span> <span class="s1">&#39;data/logs&#39;</span><span class="p">)</span>
<span class="n">figpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cpath</span><span class="p">,</span> <span class="s1">&#39;data/figs&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pth</span> <span class="ow">in</span> <span class="p">[</span><span class="n">concpath</span><span class="p">,</span> <span class="n">icemaskpath</span><span class="p">,</span> <span class="n">swathpath</span><span class="p">,</span> <span class="n">procpath</span><span class="p">,</span> <span class="n">driftpath</span><span class="p">,</span> <span class="n">logpath</span><span class="p">,</span> <span class="n">figpath</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">pth</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">pth</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>

<span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">reload</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="k">as</span> <span class="nn">ma</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pylab</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mticker</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.axes_divider</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">cmocean</span>
<span class="kn">import</span> <span class="nn">cartopy</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">from</span> <span class="nn">pyresample</span> <span class="kn">import</span> <span class="n">parse_area_file</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>

<span class="c1"># Local modules contain software code that implement the SIED algorithm</span>
<span class="k">if</span> <span class="n">algpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">algpath</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">icedrift_wrapper</span> <span class="kn">import</span> <span class="n">icedrift_wrapper</span>
<span class="kn">from</span> <span class="nn">process_ice_mask</span> <span class="kn">import</span> <span class="n">process_ice_mask</span>
<span class="kn">from</span> <span class="nn">cp_and_date_change_iceconc</span> <span class="kn">import</span> <span class="n">cp_and_date_change_iceconc</span>

<span class="c1"># Prototype re-gridding toolbox to handle the L1B input</span>
<span class="k">if</span> <span class="n">toolpath</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">toolpath</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">tools</span> <span class="kn">import</span> <span class="n">io_handler</span> <span class="k">as</span> <span class="n">io</span>
<span class="kn">from</span> <span class="nn">tools</span> <span class="kn">import</span> <span class="n">collocation</span> <span class="k">as</span> <span class="n">coll</span>
<span class="kn">from</span> <span class="nn">tools</span> <span class="kn">import</span> <span class="n">l2_format</span> <span class="k">as</span> <span class="n">l2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot settings</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> 
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> 
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;axes.labelsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>

<span class="n">font</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;family&#39;</span> <span class="p">:</span> <span class="s1">&#39;sans&#39;</span><span class="p">,</span>
        <span class="s1">&#39;weight&#39;</span> <span class="p">:</span> <span class="s1">&#39;normal&#39;</span><span class="p">,</span>
        <span class="s1">&#39;size&#39;</span>   <span class="p">:</span> <span class="mi">12</span><span class="p">}</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">font</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">viridis</span>
<span class="n">cmapland</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;grey&#39;</span><span class="p">])</span>

<span class="n">gridtype</span> <span class="o">=</span> <span class="s1">&#39;ease&#39;</span>
<span class="n">gridin</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-ease2-050&#39;</span>
<span class="n">gridout</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-ease2-250&#39;</span>
<span class="c1"># Some region parameters hard-coded to show only the relevant region</span>
<span class="c1"># Overall shape of input grid (4320, 4320)</span>
<span class="n">sl</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1050</span><span class="p">,</span> <span class="mi">1400</span><span class="p">,</span> <span class="mi">1050</span><span class="p">,</span> <span class="mi">1400</span><span class="p">)</span>
<span class="n">slo</span> <span class="o">=</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">290</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">290</span><span class="p">)</span>

<span class="c1"># EASE plotting region</span>
<span class="n">lon_min</span> <span class="o">=</span> <span class="o">-</span><span class="mi">15</span>
<span class="n">lon_max</span> <span class="o">=</span> <span class="mi">95</span>
<span class="n">lat_min</span> <span class="o">=</span> <span class="mi">74</span>
<span class="n">lat_max</span> <span class="o">=</span> <span class="mi">90</span>

<span class="c1"># Settings for gridlines</span>
<span class="n">lon_step</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">lat_step</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="parametrize-the-run">
<h2>Parametrize the run<a class="headerlink" href="#parametrize-the-run" title="Permalink to this heading">#</a></h2>
<p>User-set parameters for the running of the whole notebook. Note that here a helper script is used to copy a starter ice concentration file from the MET Norway thredds server and change the dates in this. The date changes are required due to the sample input file having a date in the future (2028).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hemi</span> <span class="o">=</span> <span class="s1">&#39;nh&#39;</span>
<span class="n">algos</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;KU&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;channels&#39;</span><span class="p">:(</span><span class="s1">&#39;tb19v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb19h&#39;</span><span class="p">),</span> <span class="s1">&#39;target_band&#39;</span><span class="p">:</span><span class="s1">&#39;KU&#39;</span><span class="p">},</span>
         <span class="s1">&#39;KA&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;channels&#39;</span><span class="p">:(</span><span class="s1">&#39;tb37v&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37h&#39;</span><span class="p">),</span> <span class="s1">&#39;target_band&#39;</span><span class="p">:</span><span class="s1">&#39;KA&#39;</span><span class="p">}}</span>
<span class="n">wbs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">algos</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">fwdbck</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;fw&#39;</span><span class="p">,</span> <span class="s1">&#39;bk&#39;</span><span class="p">]</span>
<span class="n">polarisation</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;V&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">pols</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">polarisation</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">test_card</span> <span class="o">=</span> <span class="s2">&quot;radiometric&quot;</span>
<span class="k">if</span> <span class="n">test_card</span> <span class="o">==</span> <span class="s2">&quot;geometric&quot;</span><span class="p">:</span>
    <span class="c1"># DEVALGO&#39;s simulated geometric test card</span>
    <span class="n">l1bfn</span> <span class="o">=</span> <span class="s1">&#39;W_PT-DME-Lisbon-SAT-CIMR-1B_C_DME_20230417T105425_LD_20280110T114800_20280110T115700_TN.nc&#39;</span>
<span class="k">elif</span> <span class="n">test_card</span> <span class="o">==</span> <span class="s2">&quot;radiometric&quot;</span><span class="p">:</span>
    <span class="c1"># DEVALGO&#39;s simulated radiometric test card</span>
    <span class="n">l1bfn</span> <span class="o">=</span> <span class="s1">&#39;W_PT-DME-Lisbon-SAT-CIMR-1B_C_DME_20230420T103323_LD_20280110T114800_20280110T115700_TN.nc&#39;</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;20230420T103323&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>

<span class="n">l1bfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">l1bpath</span><span class="p">,</span> <span class="n">l1bfn</span><span class="p">)</span>

<span class="n">pdate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;20280110&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">tdate</span> <span class="o">=</span> <span class="n">pdate</span> <span class="o">-</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">qdate</span> <span class="o">=</span> <span class="n">pdate</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Icemask data and output locations</span>
<span class="n">icemaskinputdir</span> <span class="o">=</span> <span class="s1">&#39;https://thredds.met.no/thredds/dodsC/osisaf/met.no/reprocessed/ice/conc_450a_files/{:%Y}/{:%m}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tdate</span><span class="p">,</span> <span class="n">tdate</span><span class="p">)</span>
<span class="n">icemaskinputfile</span> <span class="o">=</span> <span class="s1">&#39;ice_conc_</span><span class="si">{}</span><span class="s1">_ease2-250_cdr-v3p0_{:%Y%m</span><span class="si">%d</span><span class="s1">}1200.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="p">,</span> <span class="n">tdate</span><span class="p">)</span>
<span class="n">icemaskinput</span> <span class="o">=</span> <span class="n">cp_and_date_change_iceconc</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">icemaskinputdir</span><span class="p">,</span> <span class="n">icemaskinputfile</span><span class="p">),</span> <span class="n">concpath</span><span class="p">,</span> <span class="n">pdate</span><span class="p">)</span>

<span class="n">algo_version</span> <span class="o">=</span> <span class="s1">&#39;0.1&#39;</span>

<span class="n">plotfigs</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Written a version of https://thredds.met.no/thredds/dodsC/osisaf/met.no/reprocessed/ice/conc_450a_files/2018/01/ice_conc_nh_ease2-250_cdr-v3p0_201801101200.nc to /home/emilyjd/cimr-devalgo/SeaIceDrift_ATBD_v2/algorithm/../../data/conc/ice_conc_nh_ease2-250_cdr-v3p0_202801101200.nc
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-1-pre-processing-icemask-loading-the-files-laplacian-pre-processing">
<h2>Step 1: Pre-processing (Icemask, loading the files, Laplacian pre-processing)<a class="headerlink" href="#step-1-pre-processing-icemask-loading-the-files-laplacian-pre-processing" title="Permalink to this heading">#</a></h2>
<section id="step-1a-creating-and-regridding-the-ice-mask">
<h3>Step 1a: Creating and regridding the ice mask<a class="headerlink" href="#step-1a-creating-and-regridding-the-ice-mask" title="Permalink to this heading">#</a></h3>
<p>A land/ocean/ice mask is required to define the areas with ice to the algorithm. This is created from a concentration file, and is stored for future use. Since there can be multiple ice drift calculations per day on different swaths, the mask can be reused once created.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating the ice mask</span>
<span class="n">gridname</span> <span class="o">=</span> <span class="n">gridin</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="p">)</span>
<span class="n">icemaskname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">icemaskpath</span><span class="p">,</span> <span class="s1">&#39;icemask-multi-</span><span class="si">{}</span><span class="s1">-{:%Y%m</span><span class="si">%d</span><span class="s1">}12.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gridname</span><span class="p">,</span> <span class="n">pdate</span><span class="p">))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">icemaskname</span><span class="p">):</span>
    <span class="n">process_ice_mask</span><span class="p">(</span><span class="n">icemaskinput</span><span class="p">,</span> <span class="n">icemaskpath</span><span class="p">,</span> <span class="n">griddeffile</span><span class="p">,</span> <span class="n">gridname</span><span class="p">)</span>

<span class="c1"># Reading in the ice mask</span>
<span class="n">ie_data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">icemaskname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ie</span> <span class="o">=</span> <span class="n">ie_data</span><span class="p">[</span><span class="s1">&#39;ice_edge&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

<span class="c1"># And the same for the output grid</span>
<span class="n">gridnameout</span> <span class="o">=</span> <span class="n">gridout</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="p">)</span>
<span class="n">icemasknameout</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">icemaskpath</span><span class="p">,</span> <span class="s1">&#39;icemask-multi-</span><span class="si">{}</span><span class="s1">-{:%Y%m</span><span class="si">%d</span><span class="s1">}12.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gridnameout</span><span class="p">,</span> <span class="n">pdate</span><span class="p">))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">icemasknameout</span><span class="p">):</span>
    <span class="n">process_ice_mask</span><span class="p">(</span><span class="n">icemaskinput</span><span class="p">,</span> <span class="n">icemaskpath</span><span class="p">,</span> <span class="n">griddeffile</span><span class="p">,</span> <span class="n">gridnameout</span><span class="p">)</span>
<span class="n">ie_data_out</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">icemasknameout</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">ieout</span> <span class="o">=</span> <span class="n">ie_data_out</span><span class="p">[</span><span class="s1">&#39;ice_edge&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

<span class="c1"># Plotting the ice mask</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">c1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ie</span><span class="p">[:],</span> <span class="n">interpolation</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Ice mask&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

<span class="c1"># Input landmask</span>
<span class="n">landmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ie</span><span class="p">)</span>
<span class="n">landmask</span><span class="p">[</span><span class="n">ie</span> <span class="o">==</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Output landmask</span>
<span class="n">landmaskout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ieout</span><span class="p">)</span>
<span class="n">landmaskout</span><span class="p">[</span><span class="n">ieout</span> <span class="o">==</span> <span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1154b83df23d79e4dfb95aba3a677889659318052d1675f0ce77a28ec75deade.png" src="_images/1154b83df23d79e4dfb95aba3a677889659318052d1675f0ce77a28ec75deade.png" />
</div>
</div>
</section>
<section id="step-1b-loading-the-data">
<h3>Step 1b: Loading the data<a class="headerlink" href="#step-1b-loading-the-data" title="Permalink to this heading">#</a></h3>
<p>The L1B data is read in and split into forward and backward scans using software from the <code class="docutils literal notranslate"><span class="pre">Tools/</span></code> repository (a prototype CIMR Regridding Toolbox developed in the CIMR DEVALGO study). These forward and backward scans can be used independently in the algorithm in the same way as different channels and polarisations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read the bands needed of the L1B data</span>
<span class="n">reload</span><span class="p">(</span><span class="n">io</span><span class="p">)</span>

<span class="n">tb_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tb01&#39;</span><span class="p">:</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;tb06&#39;</span><span class="p">:</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;tb10&#39;</span><span class="p">:</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;tb19&#39;</span><span class="p">:</span><span class="s1">&#39;KU&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37&#39;</span><span class="p">:</span><span class="s1">&#39;KA&#39;</span><span class="p">}</span>
<span class="n">rev_tb_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">tb_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<span class="n">bands_needed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">algos</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">bands_needed</span> <span class="o">+=</span> <span class="n">algos</span><span class="p">[</span><span class="n">alg</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span>
<span class="n">bands_needed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">tb_dict</span><span class="p">[</span><span class="n">b</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bands_needed</span><span class="p">]))</span>

<span class="n">full_l1b</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">CIMR_L1B</span><span class="p">(</span><span class="n">l1bfile</span><span class="p">,</span> <span class="n">selected_bands</span><span class="o">=</span><span class="n">bands_needed</span><span class="p">,</span> <span class="n">keep_calibration_view</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split into forward / backward scan</span>

<span class="n">l1b</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">l1b</span><span class="p">[</span><span class="s1">&#39;fw&#39;</span><span class="p">],</span> <span class="n">l1b</span><span class="p">[</span><span class="s1">&#39;bk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_l1b</span><span class="o">.</span><span class="n">split_forward_backward_scans</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;horn_scan_angle&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-1c-regridding-the-data">
<h3>Step 1c: Regridding the data<a class="headerlink" href="#step-1c-regridding-the-data" title="Permalink to this heading">#</a></h3>
<p>The horns are interleaved, and then the data is regridded. These are again done with software from <code class="docutils literal notranslate"><span class="pre">Tools/</span></code>. The ice drift will be calculated individually on 8 fields based on the forward and backward scans, waveband (Ku or Ka), and polarity (V or H). A fine EASE2 grid spacing of 5km is chosen for this regridding.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regridding the data</span>

<span class="n">reload</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>

<span class="c1"># Reshaping</span>
<span class="n">l1b_r</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fwdbck</span><span class="p">:</span>
    <span class="n">l1b_r</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1b</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span><span class="o">.</span><span class="n">reshape_interleave_feed</span><span class="p">()</span>

<span class="c1"># Loading the target grid information</span>
<span class="n">gridname</span> <span class="o">=</span> <span class="n">gridin</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="p">)</span>
<span class="n">new_area_def</span> <span class="o">=</span> <span class="n">parse_area_file</span><span class="p">(</span><span class="n">griddeffile</span><span class="p">,</span> <span class="n">gridname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">new_lons</span><span class="p">,</span> <span class="n">new_lats</span> <span class="o">=</span> <span class="n">new_area_def</span><span class="o">.</span><span class="n">get_lonlats</span><span class="p">()</span>

<span class="c1"># Getting the input lat/lons</span>
<span class="n">lonlats</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span><span class="p">]:</span>
    <span class="n">lonlats</span><span class="p">[</span><span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fwdbck</span><span class="p">:</span>
        <span class="n">lonlats</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">wb</span> <span class="ow">in</span> <span class="n">wbs</span><span class="p">:</span>
            <span class="n">lonlats</span><span class="p">[</span><span class="n">ll</span><span class="p">][</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1b_r</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">wb</span><span class="p">][</span><span class="n">ll</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># Creating data arrays with the V and H layers</span>
<span class="n">what</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;brightness_temperature_v&#39;</span><span class="p">,</span> <span class="s1">&#39;brightness_temperature_h&#39;</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;method&#39;</span><span class="p">:</span><span class="s1">&#39;gauss&#39;</span><span class="p">,</span> <span class="s1">&#39;sigmas&#39;</span><span class="p">:</span><span class="mi">25000</span><span class="p">,</span> <span class="s1">&#39;neighbours&#39;</span><span class="p">:</span><span class="mi">55</span><span class="p">}</span>
<span class="n">stack_shape</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">stack</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">regrid</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fwdbck</span><span class="p">:</span>
    <span class="n">stack_shape</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">stack</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">regrid</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">wb</span> <span class="ow">in</span> <span class="n">wbs</span><span class="p">:</span>
        <span class="n">stack_shape</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">lonlats</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">what</span><span class="p">),])</span>
        <span class="n">stack</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">stack_shape</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">iw</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">what</span><span class="p">):</span>
            <span class="n">stack</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="o">...</span><span class="p">,</span><span class="n">iw</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1b_r</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">wb</span><span class="p">][</span><span class="n">w</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
            <span class="c1"># Regridding</span>
            <span class="c1"># TODO - should params be passed here? With no passing of params, a NN approach with ROI 15000 is used</span>
            <span class="n">regrid</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">_regrid_fields</span><span class="p">(</span><span class="n">new_lons</span><span class="p">,</span> <span class="n">new_lats</span><span class="p">,</span> 
                                                 <span class="n">lonlats</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">],</span> <span class="n">lonlats</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">],</span> <span class="n">stack</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot regridded</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">shapelayout</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fwdbck</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">wbs</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pols</span><span class="p">))</span>
<span class="n">axindex</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fwdbck</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">wb</span> <span class="ow">in</span> <span class="n">wbs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="n">pols</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="o">*</span><span class="n">shapelayout</span><span class="p">,</span> <span class="n">axindex</span><span class="p">)</span>
            <span class="n">c</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">regrid</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]][</span><span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">sl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sl</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">sl</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> 
                                            <span class="n">interpolation</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
            <span class="n">overland</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">landmask</span><span class="p">[</span><span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">sl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sl</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">sl</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                          <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmapland</span><span class="p">)</span>            
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">pol</span><span class="p">,</span> <span class="n">fb</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            <span class="n">axindex</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f25a2a0eee0&gt;
</pre></div>
</div>
<img alt="_images/dea07a3f183c37952dee3e6dd84b34d24f999b897587b737be11a583fb630c6a.png" src="_images/dea07a3f183c37952dee3e6dd84b34d24f999b897587b737be11a583fb630c6a.png" />
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-1d-laplacian-pre-processing">
<h1>Step 1d: Laplacian pre-processing<a class="headerlink" href="#step-1d-laplacian-pre-processing" title="Permalink to this heading">#</a></h1>
<p>Instead of directly using the brightness temperatures in the motion tracking algorithm, the ice features are stabilised and enhanced by applying a Laplacian filter (see ATBD for mathmatical description).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Laplacian pre-processing</span>

<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">laplace</span>


<span class="c1"># Replace fill value by NaN and remove mask</span>
<span class="k">def</span> <span class="nf">_get_nans</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
    <span class="n">img_masked</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img_masked</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="c1"># Replace NaN by fill value and add mask</span>
<span class="k">def</span> <span class="nf">_mask_nans</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

<span class="n">nan</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">lap</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">fv</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fwdbck</span><span class="p">:</span>
    <span class="n">nan</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">lap</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">fv</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">wb</span> <span class="ow">in</span> <span class="n">wbs</span><span class="p">:</span>
        <span class="c1"># Convert fill values to NaNs</span>
        <span class="n">nan</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_nans</span><span class="p">(</span><span class="n">regrid</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">])</span>
        <span class="c1"># Laplacian transform</span>
        <span class="n">lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="n">laplace</span><span class="p">(</span><span class="n">nan</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">])</span>
        <span class="c1"># Converting NaNs to fill values</span>
        <span class="n">fv</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="n">_mask_nans</span><span class="p">(</span><span class="n">lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">])</span>

<span class="c1"># Creating a flag field</span>
<span class="c1">#define TCIMAGE_OUTSIDE_GRID              -2</span>
<span class="c1">#define TCIMAGE_NODATA                    -1</span>
<span class="c1">#define TCIMAGE_OK                         0</span>
<span class="c1">#define TCIMAGE_UNPROCESSED                1</span>
<span class="c1">#define TCIMAGE_FAILED                     2</span>
<span class="n">flag</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fwdbck</span><span class="p">:</span>
    <span class="n">flag</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">wb</span> <span class="ow">in</span> <span class="n">wbs</span><span class="p">:</span>
        <span class="n">flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">fv</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">])</span>
        <span class="c1"># Masking where the Laplacian didn&#39;t work</span>
        <span class="n">flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">fv</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1"># Masking where the land and ocean is</span>
        <span class="n">landocean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">ie</span> <span class="o">==</span> <span class="mi">9</span><span class="p">,</span> <span class="n">ie</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">landocean</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot Laplacian</span>

<span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">shapelayout</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fwdbck</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">wbs</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pols</span><span class="p">))</span>
<span class="n">axindex</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fwdbck</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">wb</span> <span class="ow">in</span> <span class="n">wbs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="n">pols</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="o">*</span><span class="n">shapelayout</span><span class="p">,</span> <span class="n">axindex</span><span class="p">)</span>
            <span class="n">c</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">fv</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]][</span><span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">sl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sl</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">sl</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> 
                                            <span class="n">interpolation</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> 
                                            <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
            <span class="n">overland</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">landmask</span><span class="p">[</span><span class="n">sl</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">sl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sl</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">sl</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                          <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmapland</span><span class="p">)</span>            
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2"> </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">pol</span><span class="p">,</span> <span class="n">fb</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">axindex</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
            <span class="n">axindex</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f25b7d5b6d0&gt;
</pre></div>
</div>
<img alt="_images/9c5eb92e51b62c9765ecd176d8dcd1cddb7d7e4fc17cad0a6ec349697f7cc8ac.png" src="_images/9c5eb92e51b62c9765ecd176d8dcd1cddb7d7e4fc17cad0a6ec349697f7cc8ac.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="step-1e-writing-out-the-file">
<h1>Step 1e: Writing out the file<a class="headerlink" href="#step-1e-writing-out-the-file" title="Permalink to this heading">#</a></h1>
<p>For ice drift, it is not possible to keep the data only internally. Since two gridded files at different timepoints are required to create each gridded map of icedrift vectors, it is necessary to write each gridded swath file to disk so that it can be read in to be compared with other gridded swath files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note: It is deprecated, but the wrapper and C code still expect a input prog4_string, so accept the deprecation warning for now.</span>
<span class="n">crs_info</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;proj4_string&#39;</span><span class="p">:</span> <span class="n">new_area_def</span><span class="o">.</span><span class="n">proj4_string</span><span class="p">,</span>
             <span class="s1">&#39;area_id&#39;</span><span class="p">:</span> <span class="n">new_area_def</span><span class="o">.</span><span class="n">area_id</span><span class="p">,</span>
             <span class="s1">&#39;semi_major_axis&#39;</span><span class="p">:</span> <span class="mf">6378137.</span><span class="p">,</span>
             <span class="s1">&#39;semi_minor_axis&#39;</span><span class="p">:</span> <span class="mf">6356752.31424518</span><span class="p">,</span>
             <span class="s1">&#39;inverse_flattening&#39;</span><span class="p">:</span> <span class="mf">298.257223563</span><span class="p">,</span>
             <span class="s1">&#39;reference_ellipsoid_name&#39;</span><span class="p">:</span> <span class="s2">&quot;WGS 84&quot;</span><span class="p">,</span>
             <span class="s1">&#39;longitude_of_prime_meridian&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
             <span class="s1">&#39;prime_meridian_name&#39;</span><span class="p">:</span> <span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span>
             <span class="s1">&#39;geographic_crs_name&#39;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
             <span class="s1">&#39;horizontal_datum_name&#39;</span><span class="p">:</span> <span class="s2">&quot;World Geodetic System 1984&quot;</span><span class="p">,</span>
             <span class="s1">&#39;projected_crs_name&#39;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
             <span class="s1">&#39;grid_mapping_name&#39;</span><span class="p">:</span> <span class="s2">&quot;lambert_azimuthal_equal_area&quot;</span><span class="p">,</span>
             <span class="s1">&#39;latitude_of_projection_origin&#39;</span><span class="p">:</span> <span class="mf">90.</span><span class="p">,</span>
             <span class="s1">&#39;longitude_of_projection_origin&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
             <span class="s1">&#39;false_easting&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
             <span class="s1">&#39;false_northing&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/modules/rhel8/conda/install/envs/production-08-2023/lib/python3.9/site-packages/pyproj/crs/crs.py:1282: UserWarning: You will likely lose important projection information when converting to a PROJ string from another format. See: https://proj.org/faq.html#what-is-the-best-format-for-describing-coordinate-reference-systems
  proj = self._crs.to_proj4(version=version)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reload</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>

<span class="c1"># Get a template L2 format (netCDF/CF) from the Tools module</span>
<span class="n">ds_l2</span> <span class="o">=</span> <span class="n">l2</span><span class="o">.</span><span class="n">get_CIMR_L2_template</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="n">geo_def</span><span class="o">=</span><span class="n">new_area_def</span><span class="p">,</span> <span class="n">add_time</span><span class="o">=</span><span class="p">[</span><span class="n">pdate</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()])</span>

<span class="c1"># Create data arrays for the brightness temperatures, laplacian processed and status flags from the template</span>
<span class="n">shp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">regrid</span><span class="p">[</span><span class="n">fwdbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">wbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]][:,</span> <span class="p">:,</span> <span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">ds_tb</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_lap</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_flag</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fwdbck</span><span class="p">:</span>
    <span class="n">ds_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ds_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ds_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">wb</span> <span class="ow">in</span> <span class="n">wbs</span><span class="p">:</span>
        <span class="n">ds_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ds_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ds_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="n">pols</span><span class="p">:</span>
            <span class="n">chan</span> <span class="o">=</span> <span class="n">algos</span><span class="p">[</span><span class="n">wb</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]]</span>
            <span class="n">ds_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">regrid</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">),</span>
                                              <span class="n">coords</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                                              <span class="n">attrs</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">))</span>
            <span class="n">ds_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;brightness_temperature&#39;</span>
            <span class="n">ds_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Brightness temperature </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
            <span class="n">ds_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;physicalMeasurement&#39;</span>
            <span class="n">ds_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span>
            <span class="n">ds_l2</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ds_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">])</span>
            
            <span class="n">ds_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">fv</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">),</span>
                                               <span class="n">coords</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                                               <span class="n">attrs</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">_lap&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">))</span>
            <span class="n">ds_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Laplacian of brightness temperature </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
            <span class="n">ds_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auxiliaryInformation&#39;</span>
            <span class="n">ds_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ds_l2</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ds_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">])</span>
            
            <span class="n">ds_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">),</span>
                                                <span class="n">coords</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                                                <span class="n">attrs</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> 
                                                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">_lap_flag&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">))</span>
            <span class="n">ds_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;status_flag&#39;</span>
            <span class="n">ds_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Status flag for Laplacian of brightness temperature </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
            <span class="n">ds_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;qualityInformation&#39;</span>
            <span class="n">ds_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ds_l2</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ds_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">])</span>

<span class="c1"># Create a data array for dtime from the template</span>
<span class="n">dtime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">regrid</span><span class="p">[</span><span class="n">fwdbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">wbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pdate</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
<span class="n">ds_dtime</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">dtime</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                        <span class="n">attrs</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dtime&#39;</span><span class="p">)</span>
<span class="n">ds_dtime</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span>
<span class="n">ds_dtime</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>
<span class="n">ds_dtime</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auxiliaryInformation&#39;</span>
<span class="n">ds_dtime</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;seconds since 1970-01-01 00:00:00&#39;</span>
<span class="n">ds_l2</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ds_dtime</span><span class="p">)</span>

<span class="c1"># Create a data array for ice edge from the template</span>
<span class="n">ds_ie</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">ie</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">),</span> <span class="n">coords</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                     <span class="n">attrs</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ice_edge&#39;</span><span class="p">)</span>
<span class="n">ds_ie</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Ice edge&#39;</span>
<span class="n">ds_ie</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auxiliaryInformation&#39;</span>
<span class="n">ds_ie</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">ds_l2</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ds_ie</span><span class="p">)</span>

<span class="c1"># Create a data array for time, needed by the C code</span>
<span class="n">timedata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">regrid</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">pdate</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span>
<span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;vtime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">),</span> <span class="n">timedata</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,))</span>
<span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s2">&quot;seconds since 1970-01-01 00:00:00&quot;</span><span class="p">}</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auxiliaryInformation&#39;</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;seconds since 1970-01-01 00:00:00&quot;</span>

<span class="c1"># Customize the global attributes</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CIMR intermediate brightness temperatures for ice drift calculation&#39;</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Intermediate brightness temperatures and Laplacian-processed fields with their status flags, written as intermadiate-processing file for ice drift calculations&#39;</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;l1b_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">l1bfn</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;algorithm_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">algo_version</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;creator_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Emily Down&#39;</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;creator_email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;emilyjd@met.no&#39;</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;institution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Norwegian Meteorological Institute&#39;</span>

<span class="c1"># CRS information needed for C code</span>
<span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;crs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">crs_info</span>

<span class="c1"># Need to rename x and y to xc and yc for X code</span>
<span class="n">ds_l2</span><span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="s1">&#39;xc&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;yc&#39;</span><span class="p">})</span>
    
<span class="c1"># Remove the &#39;template&#39; variable (we don&#39;t need it anymore)</span>
<span class="c1">#ds_l2 = ds_l2.drop(&#39;template&#39;)</span>

<span class="c1"># Write to file</span>
<span class="n">dsname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">procpath</span><span class="p">,</span> <span class="s1">&#39;bt_</span><span class="si">{}</span><span class="s1">_{:%Y%m</span><span class="si">%d</span><span class="s1">}.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gridname</span><span class="p">,</span> <span class="n">pdate</span><span class="p">))</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">dsname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;NETCDF4_CLASSIC&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Written </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dsname</span><span class="p">))</span>

<span class="c1"># Setting this up for potential reruns</span>
<span class="n">ds_l2_copy</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Written /home/emilyjd/cimr-devalgo/SeaIceDrift_ATBD_v2/algorithm/../../data/processing/bt_nh-ease2-050_20280110.nc
</pre></div>
</div>
</div>
</div>
<section id="step-1f-temporary-creating-a-test-gridded-file-with-time-difference-24h-and-pixel-shifts-added-in-each-x-and-y">
<h2>Step 1f (temporary): Creating a test gridded file with “time difference” 24h and pixel shifts added in each x and y<a class="headerlink" href="#step-1f-temporary-creating-a-test-gridded-file-with-time-difference-24h-and-pixel-shifts-added-in-each-x-and-y" title="Permalink to this heading">#</a></h2>
<p>This is a temporary part of this notebook, to create a “test” file with different gridded brightness temperatures and a different timepoint. This is required for calculation of ice drift vectors. In this example, a constant shift of +3 pixels in the x-direction and +4 pixels in the y-direction is chosen. In operation, two swaths at different timepoints will be processed in the algorithm to retrieve the icedrift.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a shifted file. These are the pixel shifts</span>
<span class="n">pixshx</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">pixshy</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Take a copy of the data xarray</span>
<span class="n">ds_shift</span> <span class="o">=</span> <span class="n">ds_l2_copy</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Add the Laplacian mask variable</span>
<span class="n">ds_msk</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_msk</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_msk</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fwdbck</span><span class="p">:</span>
    <span class="n">ds_msk</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">wb</span> <span class="ow">in</span> <span class="n">wbs</span><span class="p">:</span>
        <span class="n">ds_msk</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="n">pols</span><span class="p">:</span>
            <span class="n">chan</span> <span class="o">=</span> <span class="n">algos</span><span class="p">[</span><span class="n">wb</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]]</span>
            <span class="n">ds_msk</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">fv</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][:,</span> <span class="p">:,</span> <span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]]</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">),</span>
                                               <span class="n">coords</span><span class="o">=</span><span class="n">ds_shift</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">ds_shift</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                                               <span class="n">attrs</span><span class="o">=</span><span class="n">ds_shift</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">_msk&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">))</span>
            <span class="n">ds_msk</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Mask for Laplacian of brightness temperature </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
            <span class="n">ds_msk</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auxiliaryInformation&#39;</span>
            <span class="n">ds_msk</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ds_shift</span> <span class="o">=</span> <span class="n">ds_shift</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ds_msk</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">pol</span><span class="p">])</span>

<span class="c1"># Shifting the data pixels of the arrays</span>
<span class="n">ds_shift_tb</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_shift_lap</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_shift_flag</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fwdbck</span><span class="p">:</span>
    <span class="n">ds_shift_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ds_shift_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ds_shift_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">wb</span> <span class="ow">in</span> <span class="n">wbs</span><span class="p">:</span>
        <span class="n">ds_shift_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ds_shift_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ds_shift_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="n">pols</span><span class="p">:</span>
            <span class="n">chan</span> <span class="o">=</span> <span class="n">algos</span><span class="p">[</span><span class="n">wb</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]]</span>
            <span class="c1"># Shift can be used in xarray to shift dimension by number of pix. Note that the dimensions must be</span>
            <span class="c1"># called x and y within xarray</span>
            <span class="n">chan</span> <span class="o">=</span> <span class="n">algos</span><span class="p">[</span><span class="n">wb</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]]</span>
            <span class="n">tbname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
            <span class="n">ds_shift_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_shift</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tbname</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">xc</span><span class="o">=</span><span class="n">pixshx</span><span class="p">,</span> <span class="n">yc</span><span class="o">=</span><span class="n">pixshy</span><span class="p">)</span>
            <span class="n">ds_shift</span><span class="p">[</span><span class="n">tbname</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ds_shift_tb</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span>
            <span class="c1"># Shifting the Laplacian field</span>
            <span class="n">lapname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">_lap&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
            <span class="n">ds_shift_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_shift</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">lapname</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">xc</span><span class="o">=</span><span class="n">pixshx</span><span class="p">,</span> <span class="n">yc</span><span class="o">=</span><span class="n">pixshy</span><span class="p">)</span>
            <span class="n">ds_shift</span><span class="p">[</span><span class="n">lapname</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ds_shift_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span>
            <span class="c1"># Flag field (want the data shifted, the landmask not)  </span>
            <span class="n">flagname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">_lap_flag&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
            <span class="n">ds_shift_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">ds_shift_lap</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">])</span>
            <span class="c1"># Masking where the Laplacian failed</span>
            <span class="n">maskname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">_msk&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
            <span class="n">fmsk_shft</span> <span class="o">=</span> <span class="n">ds_shift</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">maskname</span><span class="p">)</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">xc</span><span class="o">=</span><span class="n">pixshx</span><span class="p">,</span> <span class="n">yc</span><span class="o">=</span><span class="n">pixshy</span><span class="p">)</span>
            <span class="n">ds_shift_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">][</span><span class="n">fmsk_shft</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="c1"># Masking where the land and ocean is</span>
            <span class="n">landocean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">ie</span> <span class="o">==</span> <span class="mi">9</span><span class="p">,</span> <span class="n">ie</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
            <span class="p">(</span><span class="n">ds_shift_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">])[</span><span class="n">landocean</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ds_shift</span><span class="p">[</span><span class="n">flagname</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ds_shift_flag</span><span class="p">[</span><span class="n">fb</span><span class="p">][</span><span class="n">wb</span><span class="p">]</span>

<span class="c1"># Shift time by 24h</span>
<span class="n">ds_shift</span><span class="p">[</span><span class="s1">&#39;dtime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">regrid</span><span class="p">[</span><span class="n">fwdbck</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">wbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]][:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">qdate</span><span class="o">.</span><span class="n">timestamp</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
<span class="n">ds_shift</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="p">[</span><span class="n">qdate</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()])</span>

<span class="c1"># Remove the mask variables (we don&#39;t need them anymore)</span>
<span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fwdbck</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">wb</span> <span class="ow">in</span> <span class="n">wbs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">pol</span> <span class="ow">in</span> <span class="n">pols</span><span class="p">:</span>
            <span class="n">chan</span> <span class="o">=</span> <span class="n">algos</span><span class="p">[</span><span class="n">wb</span><span class="p">][</span><span class="s1">&#39;channels&#39;</span><span class="p">][</span><span class="n">polarisation</span><span class="p">[</span><span class="n">pol</span><span class="p">]]</span>
            <span class="n">maskname</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}{}</span><span class="s1">_msk&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
            <span class="n">ds_shift</span> <span class="o">=</span> <span class="n">ds_shift</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="n">maskname</span><span class="p">)</span>

<span class="c1"># Write to file</span>
<span class="n">dsname2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">procpath</span><span class="p">,</span> <span class="s1">&#39;bt_</span><span class="si">{}</span><span class="s1">_{:%Y%m</span><span class="si">%d</span><span class="s1">}.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gridname</span><span class="p">,</span> <span class="n">qdate</span><span class="p">))</span>
<span class="n">ds_shift</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">dsname2</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;NETCDF4_CLASSIC&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Written </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dsname2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Written /home/emilyjd/cimr-devalgo/SeaIceDrift_ATBD_v2/algorithm/../../data/processing/bt_nh-ease2-050_20280111.nc
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2-cross-correlation-algorithm">
<h2>Step 2: Cross-correlation algorithm<a class="headerlink" href="#step-2-cross-correlation-algorithm" title="Permalink to this heading">#</a></h2>
<p>For the Continuous Maximum Cross-Correlation algorithm, two brightness temperature gridded files, enhanced by the Laplacian algorithm and with different timestamps, are required. The algorithm matches features between these images on a fractional pixel grid.</p>
<p>The steps of the cross-correlation algorithm are:</p>
<ol class="arabic simple">
<li><p>Determination of which pixels should be included in the cross-correlation, excluding land and ocean pixels.</p></li>
<li><p>Fractional pixel cross-correlation simultaneously on the gridded swaths - forward/back scans, V and H polarisations, Ku and Ka channels.</p></li>
<li><p>Correction of erroneous vectors using the nearest neighbour method and creation of status flags.</p></li>
</ol>
<section id="step-2a-run-the-cross-correlation-algorithm-to-find-the-ice-drift">
<h3>Step 2a: Run the cross-correlation algorithm to find the ice drift<a class="headerlink" href="#step-2a-run-the-cross-correlation-algorithm-to-find-the-ice-drift" title="Permalink to this heading">#</a></h3>
<p>Currently the C code has limited memory for channels, so the forward and backward scans with V and H polarisations are accepted by the code. It should be possible to add Ka-band later.</p>
<p>In addition, the forward and backward scans are treated here as having the same timestamp, later it can be refined to include the 7-minute delay between these two.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Copying the files with new names, to interface with the C-code</span>

<span class="n">chanstr</span> <span class="o">=</span> <span class="s1">&#39;tb19hfw-tb19vfw-tb19hbk-tb19vbk-tb37hfw-tb37vfw-tb37hbk-tb37vbk&#39;</span>
<span class="n">newname1</span> <span class="o">=</span> <span class="s1">&#39;tc_wght_cimr-cimr_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">12.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chanstr</span><span class="p">,</span> <span class="n">gridin</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">pdate</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>
<span class="n">newname2</span> <span class="o">=</span> <span class="s1">&#39;tc_wght_cimr-cimr_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">12.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chanstr</span><span class="p">,</span> <span class="n">gridin</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">qdate</span><span class="p">,</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">dsname</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dsname</span><span class="p">),</span> <span class="n">newname1</span><span class="p">))</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">dsname2</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dsname</span><span class="p">),</span> <span class="n">newname2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;/home/emilyjd/cimr-devalgo/SeaIceDrift_ATBD_v2/algorithm/../../data/processing/tc_wght_cimr-cimr_tb19hfw-tb19vfw-tb19hbk-tb19vbk-tb37hfw-tb37vfw-tb37hbk-tb37vbk_nh-ease2-050_2028011112.nc&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span>

<span class="kn">from</span> <span class="nn">icedrift_wrapper</span> <span class="kn">import</span> <span class="n">icedrift_wrapper</span>
<span class="n">rad</span> <span class="o">=</span> <span class="mf">100.</span>
<span class="n">rad_neigh</span> <span class="o">=</span> <span class="mf">150.</span>
<span class="c1"># Original rad=75. rad_neigh=125.</span>
<span class="c1"># Worked with rad=100. rad_neigh=150.</span>
<span class="c1"># rad = 25. rad_neigh=150. has lots of corrected by neighbours, but a better field</span>
<span class="n">chan_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tb37hfw_lap&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37vfw_lap&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37hbk_lap&#39;</span><span class="p">,</span> <span class="s1">&#39;tb37vbk_lap&#39;</span><span class="p">]</span>
<span class="n">idrift</span> <span class="o">=</span> <span class="n">icedrift_wrapper</span><span class="p">(</span><span class="n">pdate</span><span class="p">,</span> <span class="n">qdate</span><span class="p">,</span> <span class="n">procpath</span><span class="p">,</span> <span class="n">procpath</span><span class="p">,</span> <span class="n">driftpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">logpath</span><span class="p">,</span> <span class="s1">&#39;cmcc-test.log&#39;</span><span class="p">),</span>
                          <span class="s1">&#39;cimr-cimr&#39;</span><span class="p">,</span> <span class="n">gridin</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="p">),</span> <span class="n">chan_list</span><span class="p">,</span> <span class="n">rad</span><span class="p">,</span> <span class="n">rad_neigh</span><span class="p">,</span> 
                          <span class="n">area_out</span><span class="o">=</span><span class="n">gridout</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Daily maps found (cimr-cimr):

	Day 1 : /home/emilyjd/cimr-devalgo/SeaIceDrift_ATBD_v2/algorithm/../../data/processing/tc_wght_cimr-cimr_tb19hfw-tb19vfw-tb19hbk-tb19vbk-tb37hfw-tb37vfw-tb37hbk-tb37vbk_nh-ease2-050_2028011012.nc 

	Day 2 : /home/emilyjd/cimr-devalgo/SeaIceDrift_ATBD_v2/algorithm/../../data/processing/tc_wght_cimr-cimr_tb19hfw-tb19vfw-tb19hbk-tb19vbk-tb37hfw-tb37vfw-tb37hbk-tb37vbk_nh-ease2-050_2028011112.nc 
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/modules/rhel8/conda/install/envs/production-08-2023/lib/python3.9/site-packages/pyproj/crs/crs.py:1282: UserWarning: You will likely lose important projection information when converting to a PROJ string from another format. See: https://proj.org/faq.html#what-is-the-best-format-for-describing-coordinate-reference-systems
  proj = self._crs.to_proj4(version=version)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calling the C core code...
 
 LOGMSG [icedrift_solve_core 2024-06-24 10:44]:
	Start processing.
 
	Log file is &lt;/home/emilyjd/cimr-devalgo/SeaIceDrift_ATBD_v2/algorithm/../../data/logs/cmcc-test.log&gt;
	Radius for pattern #0 is 100.0km
	Radius for pattern #1 is 50.0km
	Maximum drift distance is 38.88km
 ._____. ._____. ._____. ._____. ._____. ._____. {-6/+0} ._____. ._____. ._____. ._____. ._____. ._____. 



 ._____. ._____. ._____. {-5/-3} {-5/-2} {-5/-1} {-5/+0} {-5/+1} {-5/+2} {-5/+3} ._____. ._____. ._____. 



 ._____. ._____. {-4/-4} {-4/-3} {-4/-2} {-4/-1} {-4/+0} {-4/+1} {-4/+2} {-4/+3} {-4/+4} ._____. ._____. 



 ._____. {-3/-5} {-3/-4} {-3/-3} {-3/-2} {-3/-1} {-3/+0} {-3/+1} {-3/+2} {-3/+3} {-3/+4} {-3/+5} ._____. 



 ._____. {-2/-5} {-2/-4} {-2/-3} {-2/-2} {-2/-1} {-2/+0} {-2/+1} {-2/+2} {-2/+3} {-2/+4} {-2/+5} ._____. 



 ._____. {-1/-5} {-1/-4} {-1/-3} {-1/-2} {-1/-1} {-1/+0} {-1/+1} {-1/+2} {-1/+3} {-1/+4} {-1/+5} ._____. 



 {+0/-6} {+0/-5} {+0/-4} {+0/-3} {+0/-2} {+0/-1} .xxxxx. {+0/+1} {+0/+2} {+0/+3} {+0/+4} {+0/+5} {+0/+6} 



 ._____. {+1/-5} {+1/-4} {+1/-3} {+1/-2} {+1/-1} {+1/+0} {+1/+1} {+1/+2} {+1/+3} {+1/+4} {+1/+5} ._____. 



 ._____. {+2/-5} {+2/-4} {+2/-3} {+2/-2} {+2/-1} {+2/+0} {+2/+1} {+2/+2} {+2/+3} {+2/+4} {+2/+5} ._____. 



 ._____. {+3/-5} {+3/-4} {+3/-3} {+3/-2} {+3/-1} {+3/+0} {+3/+1} {+3/+2} {+3/+3} {+3/+4} {+3/+5} ._____. 



 ._____. ._____. {+4/-4} {+4/-3} {+4/-2} {+4/-1} {+4/+0} {+4/+1} {+4/+2} {+4/+3} {+4/+4} ._____. ._____. 



 ._____. ._____. ._____. {+5/-3} {+5/-2} {+5/-1} {+5/+0} {+5/+1} {+5/+2} {+5/+3} ._____. ._____. ._____. 



 ._____. ._____. ._____. ._____. ._____. ._____. {+6/+0} ._____. ._____. ._____. ._____. ._____. ._____. 



	Radius of the neighbourhood filtering pattern is 150.0km ([-6,0])
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002272}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:93153] Negative variances (-0.691242,71.908328)
ERROR (compute_Posterior_Uncertainties) [p:93157] Negative variances (2871.547503,-3184.429458)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997267}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:94448] Negative variances (-0.001343,0.006473)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,7.049183}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.663092}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996160}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:95680] Negative variances (-103.355185,2903.470393)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,20.697841}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,8.413316}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:96604] Negative variances (-0.000016,0.001591)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-4.998894}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:97012] Negative variances (0.004549,-0.000226)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.780509}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:97405] Negative variances (9121.294755,-518.129946)
ERROR (compute_Posterior_Uncertainties) [p:97430] Negative variances (-0.019507,-0.001530)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-5.577572}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:97833] Negative variances (-1558.008286,162689.683214)
ERROR (compute_Posterior_Uncertainties) [p:97837] Negative variances (-523442.934698,-650211.544018)
ERROR (compute_Posterior_Uncertainties) [p:97838] Negative variances (-122812.243853,-146912.211777)
ERROR (compute_Posterior_Uncertainties) [p:97870] Negative variances (0.004091,-0.000955)
ERROR (compute_Posterior_Uncertainties) [p:97892] Negative variances (-0.000297,0.002880)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-1.120169}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:98270] Negative variances (-148175.912802,-131296.983063)
ERROR (compute_Posterior_Uncertainties) [p:98294] Negative variances (0.002544,-0.000160)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.011379}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:98699] Negative variances (-17781.227230,-18595.076724)
ERROR (compute_Posterior_Uncertainties) [p:98705] Negative variances (-0.059315,13.288445)
ERROR (compute_Posterior_Uncertainties) [p:98709] Negative variances (0.002802,-0.004377)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004216}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:99130] Negative variances (-19818.472490,-23842.071810)
ERROR (compute_Posterior_Uncertainties) [p:99131] Negative variances (-12284.985373,-14685.239784)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.985126}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:99609] Negative variances (-0.000153,0.005980)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,16.370793}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.005277}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996494}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,13.448956}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995594}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995824}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993110}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:102597] Negative variances (0.002340,-0.000060)
ERROR (compute_Posterior_Uncertainties) [p:102605] Negative variances (-0.001555,0.002059)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998847}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.008803}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.993876}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000302}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004264}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:104751] Negative variances (-423.323978,360.353685)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002082}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:105185] Negative variances (-0.219982,12.894018)
ERROR (compute_Posterior_Uncertainties) [p:105212] Negative variances (-0.002246,0.015156)
ERROR (compute_Posterior_Uncertainties) [p:105214] Negative variances (-0.000441,0.014751)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007559}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:105642] Negative variances (0.012050,-0.000959)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.000537}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.007224}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996981}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:106959] Negative variances (-0.000830,0.007723)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999919}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.995999}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:107812] Negative variances (0.011980,-0.007557)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.992708}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:108210] Negative variances (-73.953400,301.456216)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:108644] Negative variances (-0.001610,0.763107)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.004728}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:109083] Negative variances (0.561858,-0.918691)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996777}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001129}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002336}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996971}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:110833] Negative variances (-0.000542,0.042019)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.999248}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:111264] Negative variances (-0.040125,4.258073)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.996221}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.994952}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001275}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:112525] Negative variances (4162.343781,-11240.228627)
ERROR (compute_Posterior_Uncertainties) [p:112562] Negative variances (1.256022,-2.089525)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002225}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998249}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:113387] Negative variances (-839.190639,42725.568373)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002300}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002300}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002300}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002300}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002300}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002300}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002300}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002300}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002300}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002300}. Score=-nan
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003296}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003296}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003296}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003296}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003296}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003296}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003296}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003296}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003296}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003296}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003296}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-6.524044}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-6.524044}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-6.524044}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-6.524044}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-6.524044}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-6.524044}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-6.524044}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-6.524044}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-6.524044}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-6.524044}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003845}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003845}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003845}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003845}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003845}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003845}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.003845}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:115116] Negative variances (-52.339520,4050.049013)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,19.999977}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,19.999977}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,19.999977}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,19.999977}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,19.999977}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001712}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001712}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001712}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001712}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001712}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001712}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,4.580279}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,4.580279}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,4.580279}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,4.580279}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001038}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.001038}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:116846] Negative variances (471.544407,-2133.266895)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,4.999772}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,4.999772}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,4.293586}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,4.293586}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-15.425432}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-15.425432}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,-15.425432}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.500249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.500249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.500249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,1.500249}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,4.266330}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,4.266330}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,4.266330}. Score=-nan
ERROR (compute_Posterior_Uncertainties) [p:119002] Negative variances (-177743.799537,-362909.013175)
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997432}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997432}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.997432}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998970}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998970}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998970}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998970}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998970}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,14.998970}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,15.002281}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.000000}. Score=-nan
The maximum number of iterations (1000) is reached. The best point up to now is X: {0.000000,0.
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2b-format-l2-file-and-write-to-disk">
<h3>Step 2b: Format L2 file and write to disk<a class="headerlink" href="#step-2b-format-l2-file-and-write-to-disk" title="Permalink to this heading">#</a></h3>
<p>The output icedrift file is processed and written, with metadata.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">driftx</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">idrift</span><span class="p">[</span><span class="s1">&#39;drift_x&#39;</span><span class="p">])</span>
<span class="n">driftx</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">driftx</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1e9</span>
<span class="n">drifty</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">idrift</span><span class="p">[</span><span class="s1">&#39;drift_y&#39;</span><span class="p">])</span>
<span class="n">drifty</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">drifty</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1e9</span>
<span class="n">flag</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">idrift</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">])</span>

<span class="n">dms</span> <span class="o">=</span> <span class="n">driftx</span><span class="o">.</span><span class="n">shape</span>
<span class="n">ddx</span> <span class="o">=</span> <span class="n">driftx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dms</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ddy</span> <span class="o">=</span> <span class="n">drifty</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dms</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">stdx</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">idrift</span><span class="p">[</span><span class="s1">&#39;std_x&#39;</span><span class="p">])</span>
<span class="n">stdx</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">stdx</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1e9</span>
<span class="n">stdx</span> <span class="o">=</span> <span class="n">stdx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dms</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">stdy</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">idrift</span><span class="p">[</span><span class="s1">&#39;std_y&#39;</span><span class="p">])</span>
<span class="n">stdy</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">stdy</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1e9</span>
<span class="n">stdy</span> <span class="o">=</span> <span class="n">stdy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dms</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">dflag</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">idrift</span><span class="p">[</span><span class="s1">&#39;flag&#39;</span><span class="p">])</span>
<span class="n">dflag</span> <span class="o">=</span> <span class="n">flag</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dms</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dms</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">reload</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>

<span class="c1"># Output grid</span>
<span class="n">og</span> <span class="o">=</span> <span class="n">gridout</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="p">)</span>
<span class="n">out_area_def</span> <span class="o">=</span> <span class="n">parse_area_file</span><span class="p">(</span><span class="n">griddeffile</span><span class="p">,</span> <span class="n">og</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">olons</span><span class="p">,</span> <span class="n">olats</span> <span class="o">=</span> <span class="n">out_area_def</span><span class="o">.</span><span class="n">get_lonlats</span><span class="p">()</span>

<span class="c1"># Get a template L2 format (netCDF/CF) from the Tools module</span>
<span class="n">ds_l2</span> <span class="o">=</span> <span class="n">l2</span><span class="o">.</span><span class="n">get_CIMR_L2_template</span><span class="p">(</span><span class="s1">&#39;grid&#39;</span><span class="p">,</span> <span class="n">geo_def</span><span class="o">=</span><span class="n">out_area_def</span><span class="p">,</span> <span class="n">add_time</span><span class="o">=</span><span class="p">[</span><span class="n">pdate</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()])</span>

<span class="c1"># Create a DataArray for x and y icedrift from the template</span>
<span class="n">da_dx</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">ddx</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                       <span class="n">attrs</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;driftX&#39;</span><span class="p">)</span>
<span class="n">da_dx</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x-component of Sea Ice Drift from the CIMR ice drift algorithm v</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo_version</span><span class="p">)</span>
<span class="n">da_dx</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;x_component_sea_ice_drift&#39;</span>
<span class="n">da_dx</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>
<span class="n">da_dx</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;physicalMeasurement&#39;</span>
<span class="n">da_dx</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;auxiliary_variables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;status_flag&#39;</span>
<span class="n">da_dy</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">ddy</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                       <span class="n">attrs</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;driftY&#39;</span><span class="p">)</span>
<span class="n">da_dy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;y-component of Sea Ice Drift from the CIMR ice drift algorithm v</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo_version</span><span class="p">)</span>
<span class="n">da_dy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;standard_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;y_component_sea_ice_drift&#39;</span>
<span class="n">da_dy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>
<span class="n">da_dy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;physicalMeasurement&#39;</span>
<span class="n">da_dy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;auxiliary_variables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;status_flag&#39;</span>

<span class="c1"># Create a DataArray for std x and y icedrift from the template</span>
<span class="n">da_stddx</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">stdx</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                       <span class="n">attrs</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;stdX&#39;</span><span class="p">)</span>
<span class="n">da_stddx</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Standard deviation of x-component of Sea Ice Drift from the CIMR ice drift algorithm v</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo_version</span><span class="p">)</span>
<span class="n">da_stddx</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>
<span class="n">da_stddx</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auxiliaryInformation&#39;</span>
<span class="n">da_stddx</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;auxiliary_variables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;status_flag&#39;</span>
<span class="n">da_stddy</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">stdy</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                       <span class="n">attrs</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;stdY&#39;</span><span class="p">)</span>
<span class="n">da_stddy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Standard deviation of y-component of Sea Ice Drift from the CIMR ice drift algorithm v</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo_version</span><span class="p">)</span>
<span class="n">da_stddy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;km&#39;</span>
<span class="n">da_stddy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auxiliaryInformation&#39;</span>
<span class="n">da_stddy</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;auxiliary_variables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;status_flag&#39;</span>

<span class="c1"># Create a DataArray for the status flag from the template</span>
<span class="n">da_flag</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">dflag</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">,</span>
                       <span class="n">attrs</span><span class="o">=</span><span class="n">ds_l2</span><span class="p">[</span><span class="s1">&#39;template&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;status_flag&#39;</span><span class="p">)</span>
<span class="n">da_flag</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Status flag of Sea Ice Drift from the CIMR ice drift algorithm v</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">algo_version</span><span class="p">)</span>
<span class="n">da_flag</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">da_flag</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;coverage_content_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auxiliaryInformation&#39;</span>

<span class="c1"># Add the data arrays to the ds_l2 object</span>
<span class="n">ds_l2</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">da_dx</span><span class="p">)</span>
<span class="n">ds_l2</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">da_dy</span><span class="p">)</span>
<span class="n">ds_l2</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">da_stddx</span><span class="p">)</span>
<span class="n">ds_l2</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">da_stddy</span><span class="p">)</span>
<span class="n">ds_l2</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">da_flag</span><span class="p">)</span>

<span class="c1"># Customize the global attributes</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CIMR L2 Sea Ice Drift&#39;</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Sea Ice Drift computed with the prototype algorithm developed in the ESA CIMR DEVALGO study. The algorithm combines Ku and Ka imagery channels. The product file contains the sea ice drift, its uncertainties, and processing flags.&#39;</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;l1b_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">l1bfile</span><span class="p">)</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;algorithm_version&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">algo_version</span>

<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;creator_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Emily Down and Thomas Lavergne&#39;</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;creator_email&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;emilyjd@met.no&#39;</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;institution&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Norwegian Meteorological Institute&#39;</span>

<span class="c1"># Remove the &#39;template&#39; variable (we don&#39;t need it anymore)</span>
<span class="n">ds_l2</span> <span class="o">=</span> <span class="n">ds_l2</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">)</span>

<span class="c1"># Write to file</span>
<span class="n">l2_n</span> <span class="o">=</span> <span class="s1">&#39;cimr_devalgo_l2_sid_</span><span class="si">{}</span><span class="s1">_</span><span class="si">{}</span><span class="s1">.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">og</span><span class="p">,</span> <span class="n">test_card</span><span class="p">)</span>
<span class="n">l2_n</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">driftpath</span><span class="p">,</span> <span class="n">l2_n</span><span class="p">)</span>
<span class="n">ds_l2</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">l2_n</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;NETCDF4_CLASSIC&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">l2_n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/emilyjd/cimr-devalgo/SeaIceDrift_ATBD_v2/algorithm/../../data/icedrift/cimr_devalgo_l2_sid_nh-ease2-250_radiometric.nc
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2c-plotting">
<h3>Step 2c: Plotting<a class="headerlink" href="#step-2c-plotting" title="Permalink to this heading">#</a></h3>
<p>Here an example plot of the icedrift output is made.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">crs_create</span><span class="p">(</span><span class="n">gridtype</span><span class="p">,</span> <span class="n">hemi</span><span class="p">):</span>

    <span class="c1"># Define grid based on region</span>
    <span class="k">if</span> <span class="n">gridtype</span> <span class="o">==</span> <span class="s1">&#39;polstere&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hemi</span> <span class="o">==</span> <span class="s1">&#39;nh&#39;</span><span class="p">:</span>
            <span class="n">plot_proj4_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;proj&#39;</span><span class="p">:</span> <span class="s1">&#39;stere&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;lat_0&#39;</span><span class="p">:</span> <span class="mf">90.</span><span class="p">,</span>
                                 <span class="s1">&#39;lat_ts&#39;</span> <span class="p">:</span> <span class="mf">70.</span><span class="p">,</span>
                                 <span class="s1">&#39;lon_0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">45.0</span><span class="p">,</span>
                                 <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">6378273</span><span class="p">,</span>
                                 <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">6356889.44891</span><span class="p">}</span>
            <span class="n">plot_globe</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">plot_proj4_params</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span>
                                    <span class="n">semiminor_axis</span><span class="o">=</span><span class="n">plot_proj4_params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
            <span class="n">plot_crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span>
                <span class="n">central_longitude</span><span class="o">=</span><span class="n">plot_proj4_params</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">],</span> <span class="n">globe</span><span class="o">=</span><span class="n">plot_globe</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_proj4_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;proj&#39;</span><span class="p">:</span> <span class="s1">&#39;stere&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;lat_0&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">90.</span><span class="p">,</span>
                                 <span class="s1">&#39;lat_ts&#39;</span> <span class="p">:</span> <span class="o">-</span><span class="mf">70.</span><span class="p">,</span>
                                 <span class="s1">&#39;lon_0&#39;</span><span class="p">:</span> <span class="mf">0.</span><span class="p">,</span>
                                 <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">6378273</span><span class="p">,</span>
                                 <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">6356889.44891</span><span class="p">}</span>
            <span class="n">plot_globe</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Globe</span><span class="p">(</span><span class="n">semimajor_axis</span><span class="o">=</span><span class="n">plot_proj4_params</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">],</span>
                                    <span class="n">semiminor_axis</span><span class="o">=</span><span class="n">plot_proj4_params</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
            <span class="n">plot_crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">(</span>
                <span class="n">central_longitude</span><span class="o">=</span><span class="n">plot_proj4_params</span><span class="p">[</span><span class="s1">&#39;lon_0&#39;</span><span class="p">],</span> <span class="n">globe</span><span class="o">=</span><span class="n">plot_globe</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">gridtype</span> <span class="o">==</span> <span class="s1">&#39;ease&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hemi</span> <span class="o">==</span> <span class="s1">&#39;nh&#39;</span><span class="p">:</span>
            <span class="n">plot_crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertAzimuthalEqualArea</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                      <span class="n">central_latitude</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                                                      <span class="n">false_easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                      <span class="n">false_northing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plot_crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertAzimuthalEqualArea</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                      <span class="n">central_latitude</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span>
                                                      <span class="n">false_easting</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                      <span class="n">false_northing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unrecognised region </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">region</span><span class="p">))</span>

    <span class="k">return</span><span class="p">(</span><span class="n">plot_crs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">flag_arrow_col</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">procfmt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">procfmt</span><span class="p">:</span>
        <span class="n">flgfmt</span> <span class="o">=</span> <span class="s1">&#39;proc&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">flgfmt</span> <span class="o">=</span> <span class="s1">&#39;final&#39;</span>

    <span class="c1"># Use colours from https://sashamaps.net/docs/resources/20-colors/</span>
    <span class="n">fblack</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span>
    <span class="n">fmaroon</span> <span class="o">=</span> <span class="s1">&#39;#800000&#39;</span>
    <span class="n">forange</span> <span class="o">=</span> <span class="s1">&#39;#f58231&#39;</span>
    <span class="n">fnavy</span> <span class="o">=</span> <span class="s1">&#39;#000075&#39;</span>
    <span class="n">fblue</span> <span class="o">=</span> <span class="s1">&#39;#4363d8&#39;</span>
    <span class="n">flavender</span> <span class="o">=</span> <span class="s1">&#39;#dcbeff&#39;</span>
    <span class="n">fgrey</span> <span class="o">=</span> <span class="s1">&#39;#a9a9a9&#39;</span>

    <span class="n">fbrown</span> <span class="o">=</span> <span class="s1">&#39;#9A6324&#39;</span>
    <span class="n">fteal</span> <span class="o">=</span> <span class="s1">&#39;#469990&#39;</span>
    <span class="n">fgreen</span> <span class="o">=</span> <span class="s1">&#39;#3cb44b&#39;</span>
    <span class="n">fcyan</span> <span class="o">=</span> <span class="s1">&#39;#42d4f4&#39;</span>
    <span class="n">fmagenta</span> <span class="o">=</span> <span class="s1">&#39;#f032e6&#39;</span>

    <span class="n">fred</span> <span class="o">=</span> <span class="s1">&#39;#e6194B&#39;</span>
    <span class="n">fpurple</span> <span class="o">=</span> <span class="s1">&#39;#911eb4&#39;</span>

    <span class="n">flag_cols</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">flag_cols</span><span class="p">[</span><span class="s1">&#39;final&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">30</span><span class="p">:</span> <span class="n">fblack</span><span class="p">,</span>   <span class="c1"># Nominal quality</span>
                          <span class="mi">20</span><span class="p">:</span> <span class="n">fbrown</span><span class="p">,</span>   <span class="c1"># Single-sensor, with smaller pattern</span>
                                        <span class="c1"># block</span>
                          <span class="mi">21</span><span class="p">:</span> <span class="n">forange</span><span class="p">,</span>  <span class="c1"># Single-sensor, with neighbours as</span>
                                        <span class="c1"># constraint</span>
                          <span class="mi">22</span><span class="p">:</span> <span class="n">fmaroon</span><span class="p">,</span>  <span class="c1"># Interpolated</span>
                          <span class="mi">23</span><span class="p">:</span> <span class="n">fcyan</span><span class="p">,</span>    <span class="c1"># Gap filling in wind drift</span>
                          <span class="mi">24</span><span class="p">:</span> <span class="n">fteal</span><span class="p">,</span>    <span class="c1"># Vector replaced by wind drift</span>
                          <span class="mi">25</span><span class="p">:</span> <span class="n">fnavy</span><span class="p">,</span>    <span class="c1"># Blended satellite and wind drift</span>
<span class="p">}</span>
    <span class="n">flag_cols</span><span class="p">[</span><span class="s1">&#39;proc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">fblack</span><span class="p">,</span>     <span class="c1"># Nominal quality</span>
                         <span class="mi">16</span><span class="p">:</span> <span class="n">fpurple</span><span class="p">,</span>   <span class="c1"># Interpolated</span>
                         <span class="mi">13</span><span class="p">:</span> <span class="n">fred</span><span class="p">,</span>      <span class="c1"># Single-sensor, with neighbours as</span>
                                        <span class="c1"># constraint</span>
                         <span class="mi">17</span><span class="p">:</span> <span class="n">fgreen</span><span class="p">,</span>    <span class="c1"># Single-sensor, with smaller</span>
                                        <span class="c1"># pattern block</span>
<span class="p">}</span>

    <span class="n">default</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">flag_cols</span><span class="p">[</span><span class="n">flgfmt</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">flag_cols</span><span class="p">[</span><span class="n">flgfmt</span><span class="p">][</span><span class="n">flag</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">default</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scale</span> <span class="o">=</span> <span class="mf">1000.</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">plotdriftarr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plot_crs</span><span class="p">,</span> <span class="n">data_crs</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">sflag</span><span class="p">,</span> <span class="n">driftflags</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dx</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">plot_crs</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span><span class="p">[</span><span class="o">~</span><span class="n">dx</span><span class="o">.</span><span class="n">mask</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">lat</span><span class="p">[</span><span class="o">~</span><span class="n">dx</span><span class="o">.</span><span class="n">mask</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">src_crs</span><span class="o">=</span><span class="n">pc</span><span class="p">)</span>
            <span class="n">adx</span> <span class="o">=</span> <span class="n">dx</span><span class="p">[</span><span class="o">~</span><span class="n">dx</span><span class="o">.</span><span class="n">mask</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">ady</span> <span class="o">=</span> <span class="n">dy</span><span class="p">[</span><span class="o">~</span><span class="n">dy</span><span class="o">.</span><span class="n">mask</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">len_arrow</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">adx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">ady</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Calculate the endpoints and therefore dx, dy components of the drift arrows in the plot</span>
            <span class="c1"># coordinate system</span>
            <span class="n">xorig</span><span class="p">,</span> <span class="n">yorig</span> <span class="o">=</span> <span class="n">data_crs</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lon</span><span class="p">[</span><span class="o">~</span><span class="n">dx</span><span class="o">.</span><span class="n">mask</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">lat</span><span class="p">[</span><span class="o">~</span><span class="n">dx</span><span class="o">.</span><span class="n">mask</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">src_crs</span><span class="o">=</span><span class="n">pc</span><span class="p">)</span>
            <span class="n">xarr</span> <span class="o">=</span> <span class="n">xorig</span> <span class="o">+</span> <span class="n">adx</span>
            <span class="n">yarr</span> <span class="o">=</span> <span class="n">yorig</span> <span class="o">+</span> <span class="n">ady</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">plot_crs</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">yarr</span><span class="p">,</span> <span class="n">src_crs</span><span class="o">=</span><span class="n">data_crs</span><span class="p">)</span>
            <span class="n">pdx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>
            <span class="n">pdy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>
            
            <span class="c1"># Set the colour of the drift arrows if this should be</span>
            <span class="c1"># done with status flags</span>
            <span class="k">if</span> <span class="n">driftflags</span><span class="p">:</span>
                <span class="n">myflag</span> <span class="o">=</span> <span class="n">sflag</span><span class="p">[</span><span class="o">~</span><span class="n">dx</span><span class="o">.</span><span class="n">mask</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">ar_col</span> <span class="o">=</span> <span class="n">flag_arrow_col</span><span class="p">(</span><span class="n">myflag</span><span class="p">,</span> <span class="n">procfmt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ar_col</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>

            <span class="c1"># If the arrow is too small, mark a symbol instead</span>
            <span class="k">if</span> <span class="n">len_arrow</span> <span class="o">*</span> <span class="n">scale</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">ar_col</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">head_length</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">len_arrow</span> <span class="o">*</span> <span class="n">scale</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">pdx</span><span class="p">,</span> <span class="n">pdy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">ar_col</span><span class="p">,</span>
                    <span class="n">shape</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="n">head_length</span><span class="p">,</span>
                    <span class="n">head_width</span><span class="o">=</span><span class="mi">15000</span><span class="p">,</span>
                    <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="mi">4000</span><span class="p">)</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c1"># Outside the range of points</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting the ice drift with arrows</span>
<span class="c1"># Modified from the SeaSurfaceTemperature_ATBD_v2, by Emy Alerskans</span>

<span class="c1"># Drift data</span>
<span class="n">xydata</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;dx&#39;</span><span class="p">:</span> <span class="n">driftx</span><span class="p">,</span> <span class="s1">&#39;dy&#39;</span><span class="p">:</span> <span class="n">drifty</span><span class="p">}</span>
<span class="n">limminxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">xydata</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">limminxy</span> <span class="o">=</span> <span class="n">limminxy</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limminxy</span><span class="p">)</span>
<span class="n">limmaxxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">xydata</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">limmaxxy</span> <span class="o">=</span> <span class="n">limmaxxy</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">limmaxxy</span><span class="p">)</span>
<span class="n">limminflag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
<span class="n">limmaxflag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>

<span class="c1"># Output lat/lons</span>
<span class="n">og</span> <span class="o">=</span> <span class="n">gridout</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hemi</span><span class="p">)</span>
<span class="n">out_area_def</span> <span class="o">=</span> <span class="n">parse_area_file</span><span class="p">(</span><span class="n">griddeffile</span><span class="p">,</span> <span class="n">og</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">olons</span><span class="p">,</span> <span class="n">olats</span> <span class="o">=</span> <span class="n">out_area_def</span><span class="o">.</span><span class="n">get_lonlats</span><span class="p">()</span>

<span class="c1"># Coordinate reference systems</span>
<span class="n">plot_crs</span> <span class="o">=</span> <span class="n">crs_create</span><span class="p">(</span><span class="n">gridtype</span><span class="p">,</span> <span class="n">hemi</span><span class="p">)</span>
<span class="n">pc</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
<span class="k">if</span> <span class="s1">&#39;ease&#39;</span> <span class="ow">in</span> <span class="n">gridout</span><span class="p">:</span>
    <span class="n">data_crs</span> <span class="o">=</span> <span class="n">crs_create</span><span class="p">(</span><span class="s1">&#39;ease&#39;</span><span class="p">,</span> <span class="n">hemi</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">data_crs</span> <span class="o">=</span> <span class="n">crs_create</span><span class="p">(</span><span class="s1">&#39;polstere&#39;</span><span class="p">,</span> <span class="n">hemi</span><span class="p">)</span>

<span class="c1"># Plotting drift</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">plot_crs</span><span class="p">)</span>

<span class="n">plotdriftarr</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">plot_crs</span><span class="p">,</span> <span class="n">data_crs</span><span class="p">,</span> <span class="n">olons</span><span class="p">[</span><span class="n">slo</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slo</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">olats</span><span class="p">[</span><span class="n">slo</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slo</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> 
             <span class="n">driftx</span><span class="p">[</span><span class="n">slo</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slo</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">drifty</span><span class="p">[</span><span class="n">slo</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slo</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
             <span class="n">flag</span><span class="p">[</span><span class="n">slo</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slo</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">driftflags</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">])</span>
<span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">gl</span><span class="o">.</span><span class="n">xlocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">lon_step</span><span class="p">))</span>
<span class="n">gl</span><span class="o">.</span><span class="n">ylocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">lat_step</span><span class="p">))</span>
<span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">}</span>
<span class="n">gl</span><span class="o">.</span><span class="n">ylabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">}</span>    

<span class="k">if</span> <span class="n">plotfigs</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">figpath</span><span class="p">,</span> <span class="s1">&#39;drift_rad</span><span class="si">{}</span><span class="s1">.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rad</span><span class="p">))))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Status flags</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">plot_crs</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">olons</span><span class="p">[</span><span class="n">slo</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slo</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">olats</span><span class="p">[</span><span class="n">slo</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slo</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> 
                    <span class="n">flag</span><span class="p">[:][</span><span class="n">slo</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">slo</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">slo</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">transform</span><span class="o">=</span><span class="n">pc</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">limminflag</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">limmaxflag</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">])</span>
<span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">gl</span><span class="o">.</span><span class="n">xlocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">lon_step</span><span class="p">))</span>
<span class="n">gl</span><span class="o">.</span><span class="n">ylocator</span> <span class="o">=</span> <span class="n">mticker</span><span class="o">.</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">lat_step</span><span class="p">))</span>
<span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">}</span>
<span class="n">gl</span><span class="o">.</span><span class="n">ylabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">}</span>
        
<span class="c1"># Colourbar</span>
<span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;3%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">axes_class</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span>
<span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>
<span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Flag&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mf">20.0</span><span class="p">)</span>
<span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">limminflag</span><span class="p">,</span> <span class="n">limmaxflag</span><span class="p">)</span>
        
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\</span>
<span class="s2">FLAG VALUES </span><span class="se">\n\</span>
<span class="s2">Unprocessed pixel                              -1</span><span class="se">\n\</span>
<span class="s2">Nominal                                        0</span><span class="se">\n\</span>
<span class="s2">Outside image border                           1</span><span class="se">\n\</span>
<span class="s2">Close to image border                          2</span><span class="se">\n\</span>
<span class="s2">Pixel center over land                         3</span><span class="se">\n\</span>
<span class="s2">No ice                                         4</span><span class="se">\n\</span>
<span class="s2">Close to coast or edge                         5</span><span class="se">\n\</span>
<span class="s2">Close to missing pixel                         6</span><span class="se">\n\</span>
<span class="s2">Close to unprocessed pixel                     7</span><span class="se">\n\</span>
<span class="s2">Icedrift optimisation failed                   8</span><span class="se">\n\</span>
<span class="s2">Icedrift failed                                9</span><span class="se">\n\</span>
<span class="s2">Icedrift with low correlation                  10</span><span class="se">\n\</span>
<span class="s2">Icedrift calculation took too long             11</span><span class="se">\n\</span>
<span class="s2">Icedrift calculation refused by neighbours     12</span><span class="se">\n\</span>
<span class="s2">Icedrift calculation corrected by neighbours   13</span><span class="se">\n\</span>
<span class="s2">Icedrift no average                            14</span><span class="se">\n\</span>
<span class="s2">Icedrift masked due to summer season           15</span><span class="se">\n\</span>
<span class="s2">Icedrift multi-oi interpolation                16</span><span class="se">\n\</span>
<span class="s2">Icedrift calcuated with smaller pattern        17</span><span class="se">\n\</span>
<span class="s2">Icedrift masked due to NWP                     18</span><span class="se">\n\</span>
<span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ace377039b856cfc7fdcf6229d49d354c79ca57f19a974f36bada17f8b691bb9.png" src="_images/ace377039b856cfc7fdcf6229d49d354c79ca57f19a974f36bada17f8b691bb9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FLAG VALUES 
Unprocessed pixel                              -1
Nominal                                        0
Outside image border                           1
Close to image border                          2
Pixel center over land                         3
No ice                                         4
Close to coast or edge                         5
Close to missing pixel                         6
Close to unprocessed pixel                     7
Icedrift optimisation failed                   8
Icedrift failed                                9
Icedrift with low correlation                  10
Icedrift calculation took too long             11
Icedrift calculation refused by neighbours     12
Icedrift calculation corrected by neighbours   13
Icedrift no average                            14
Icedrift masked due to summer season           15
Icedrift multi-oi interpolation                16
Icedrift calcuated with smaller pattern        17
Icedrift masked due to NWP                     18
</pre></div>
</div>
<img alt="_images/3e43a065d239042e7b0a5797505372f43db083d0ead6b35ce47e96c54b5eead7.png" src="_images/3e43a065d239042e7b0a5797505372f43db083d0ead6b35ce47e96c54b5eead7.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="algorithm_input_output_data_definition.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Algorithm Input and Output Data Definition (IODD)</p>
      </div>
    </a>
    <a class="right-next"
       href="CIMR_L2_Sea_Ice_Drift_performanceAssessment.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">A Level-2 Sea Ice Drift (SID) algorithm for CIMR</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">A Level-2 Sea Ice Drift (SID) algorithm for CIMR</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#settings">Settings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parametrize-the-run">Parametrize the run</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-pre-processing-icemask-loading-the-files-laplacian-pre-processing">Step 1: Pre-processing (Icemask, loading the files, Laplacian pre-processing)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1a-creating-and-regridding-the-ice-mask">Step 1a: Creating and regridding the ice mask</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1b-loading-the-data">Step 1b: Loading the data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1c-regridding-the-data">Step 1c: Regridding the data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1d-laplacian-pre-processing">Step 1d: Laplacian pre-processing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1e-writing-out-the-file">Step 1e: Writing out the file</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1f-temporary-creating-a-test-gridded-file-with-time-difference-24h-and-pixel-shifts-added-in-each-x-and-y">Step 1f (temporary): Creating a test gridded file with “time difference” 24h and pixel shifts added in each x and y</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-cross-correlation-algorithm">Step 2: Cross-correlation algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2a-run-the-cross-correlation-algorithm-to-find-the-ice-drift">Step 2a: Run the cross-correlation algorithm to find the ice drift</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2b-format-l2-file-and-write-to-disk">Step 2b: Format L2 file and write to disk</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2c-plotting">Step 2c: Plotting</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Lavergne and Emily Down, Norwegian Meteorological Institute
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <p>
This ATBD was developed in the context of the ESA-funded CIMR DEVALGO study (2022-2024) (contract 4000137493).
<br>
ESA is not responsible in any way for the content of this document.
</p>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=bd9e20870c6007c4c509"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=bd9e20870c6007c4c509"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>